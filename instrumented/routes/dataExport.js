"use strict";
/*
 * Copyright (c) 2014-2022 Bjoern Kimminich & the OWASP Juice Shop contributors.
 * SPDX-License-Identifier: MIT
 */

function cov_1c3i5590w3() {
  var path = "/home/shubham/Desktop/juice-shop/build/routes/dataExport.js";
  var hash = "ea22bf20e0da865f75fe2d6bfcafa919ab9a5860";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/shubham/Desktop/juice-shop/build/routes/dataExport.js",
    statementMap: {
      "0": {
        start: {
          line: 6,
          column: 0
        },
        end: {
          line: 6,
          column: 62
        }
      },
      "1": {
        start: {
          line: 7,
          column: 17
        },
        end: {
          line: 7,
          column: 44
        }
      },
      "2": {
        start: {
          line: 8,
          column: 23
        },
        end: {
          line: 8,
          column: 55
        }
      },
      "3": {
        start: {
          line: 9,
          column: 17
        },
        end: {
          line: 9,
          column: 45
        }
      },
      "4": {
        start: {
          line: 10,
          column: 11
        },
        end: {
          line: 10,
          column: 37
        }
      },
      "5": {
        start: {
          line: 11,
          column: 19
        },
        end: {
          line: 11,
          column: 58
        }
      },
      "6": {
        start: {
          line: 12,
          column: 0
        },
        end: {
          line: 74,
          column: 2
        }
      },
      "7": {
        start: {
          line: 13,
          column: 4
        },
        end: {
          line: 73,
          column: 6
        }
      },
      "8": {
        start: {
          line: 15,
          column: 29
        },
        end: {
          line: 15,
          column: 204
        }
      },
      "9": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 72,
          column: 9
        }
      },
      "10": {
        start: {
          line: 17,
          column: 29
        },
        end: {
          line: 17,
          column: 55
        }
      },
      "11": {
        start: {
          line: 18,
          column: 26
        },
        end: {
          line: 18,
          column: 49
        }
      },
      "12": {
        start: {
          line: 19,
          column: 33
        },
        end: {
          line: 19,
          column: 64
        }
      },
      "13": {
        start: {
          line: 20,
          column: 29
        },
        end: {
          line: 26,
          column: 13
        }
      },
      "14": {
        start: {
          line: 27,
          column: 29
        },
        end: {
          line: 27,
          column: 103
        }
      },
      "15": {
        start: {
          line: 28,
          column: 12
        },
        end: {
          line: 33,
          column: 15
        }
      },
      "16": {
        start: {
          line: 29,
          column: 16
        },
        end: {
          line: 32,
          column: 19
        }
      },
      "17": {
        start: {
          line: 34,
          column: 12
        },
        end: {
          line: 68,
          column: 15
        }
      },
      "18": {
        start: {
          line: 35,
          column: 16
        },
        end: {
          line: 45,
          column: 17
        }
      },
      "19": {
        start: {
          line: 36,
          column: 20
        },
        end: {
          line: 44,
          column: 23
        }
      },
      "20": {
        start: {
          line: 37,
          column: 24
        },
        end: {
          line: 43,
          column: 27
        }
      },
      "21": {
        start: {
          line: 46,
          column: 16
        },
        end: {
          line: 65,
          column: 19
        }
      },
      "22": {
        start: {
          line: 47,
          column: 20
        },
        end: {
          line: 57,
          column: 21
        }
      },
      "23": {
        start: {
          line: 48,
          column: 24
        },
        end: {
          line: 56,
          column: 27
        }
      },
      "24": {
        start: {
          line: 49,
          column: 28
        },
        end: {
          line: 55,
          column: 31
        }
      },
      "25": {
        start: {
          line: 58,
          column: 38
        },
        end: {
          line: 58,
          column: 70
        }
      },
      "26": {
        start: {
          line: 59,
          column: 20
        },
        end: {
          line: 61,
          column: 21
        }
      },
      "27": {
        start: {
          line: 60,
          column: 24
        },
        end: {
          line: 60,
          column: 140
        }
      },
      "28": {
        start: {
          line: 60,
          column: 87
        },
        end: {
          line: 60,
          column: 136
        }
      },
      "29": {
        start: {
          line: 62,
          column: 20
        },
        end: {
          line: 62,
          column: 159
        }
      },
      "30": {
        start: {
          line: 64,
          column: 20
        },
        end: {
          line: 64,
          column: 84
        }
      },
      "31": {
        start: {
          line: 67,
          column: 16
        },
        end: {
          line: 67,
          column: 79
        }
      },
      "32": {
        start: {
          line: 71,
          column: 12
        },
        end: {
          line: 71,
          column: 91
        }
      }
    },
    fnMap: {
      "0": {
        name: "dataExport",
        decl: {
          start: {
            line: 12,
            column: 26
          },
          end: {
            line: 12,
            column: 36
          }
        },
        loc: {
          start: {
            line: 12,
            column: 39
          },
          end: {
            line: 74,
            column: 1
          }
        },
        line: 12
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 13,
            column: 11
          },
          end: {
            line: 13,
            column: 12
          }
        },
        loc: {
          start: {
            line: 13,
            column: 37
          },
          end: {
            line: 73,
            column: 5
          }
        },
        line: 13
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 28,
            column: 29
          },
          end: {
            line: 28,
            column: 30
          }
        },
        loc: {
          start: {
            line: 28,
            column: 41
          },
          end: {
            line: 33,
            column: 13
          }
        },
        line: 28
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 34,
            column: 57
          },
          end: {
            line: 34,
            column: 58
          }
        },
        loc: {
          start: {
            line: 34,
            column: 69
          },
          end: {
            line: 66,
            column: 13
          }
        },
        line: 34
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 36,
            column: 35
          },
          end: {
            line: 36,
            column: 36
          }
        },
        loc: {
          start: {
            line: 36,
            column: 44
          },
          end: {
            line: 44,
            column: 21
          }
        },
        line: 36
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 46,
            column: 56
          },
          end: {
            line: 46,
            column: 57
          }
        },
        loc: {
          start: {
            line: 46,
            column: 69
          },
          end: {
            line: 63,
            column: 17
          }
        },
        line: 46
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 48,
            column: 40
          },
          end: {
            line: 48,
            column: 41
          }
        },
        loc: {
          start: {
            line: 48,
            column: 50
          },
          end: {
            line: 56,
            column: 25
          }
        },
        line: 48
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 60,
            column: 79
          },
          end: {
            line: 60,
            column: 80
          }
        },
        loc: {
          start: {
            line: 60,
            column: 85
          },
          end: {
            line: 60,
            column: 138
          }
        },
        line: 60
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 63,
            column: 19
          },
          end: {
            line: 63,
            column: 20
          }
        },
        loc: {
          start: {
            line: 63,
            column: 25
          },
          end: {
            line: 65,
            column: 17
          }
        },
        line: 63
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 66,
            column: 15
          },
          end: {
            line: 66,
            column: 16
          }
        },
        loc: {
          start: {
            line: 66,
            column: 21
          },
          end: {
            line: 68,
            column: 13
          }
        },
        line: 66
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 15,
            column: 61
          },
          end: {
            line: 15,
            column: 203
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 15,
            column: 169
          },
          end: {
            line: 15,
            column: 175
          }
        }, {
          start: {
            line: 15,
            column: 178
          },
          end: {
            line: 15,
            column: 203
          }
        }],
        line: 15
      },
      "1": {
        loc: {
          start: {
            line: 15,
            column: 61
          },
          end: {
            line: 15,
            column: 166
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 15,
            column: 61
          },
          end: {
            line: 15,
            column: 149
          }
        }, {
          start: {
            line: 15,
            column: 153
          },
          end: {
            line: 15,
            column: 166
          }
        }],
        line: 15
      },
      "2": {
        loc: {
          start: {
            line: 15,
            column: 67
          },
          end: {
            line: 15,
            column: 139
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 15,
            column: 114
          },
          end: {
            line: 15,
            column: 120
          }
        }, {
          start: {
            line: 15,
            column: 123
          },
          end: {
            line: 15,
            column: 139
          }
        }],
        line: 15
      },
      "3": {
        loc: {
          start: {
            line: 15,
            column: 67
          },
          end: {
            line: 15,
            column: 111
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 15,
            column: 67
          },
          end: {
            line: 15,
            column: 94
          }
        }, {
          start: {
            line: 15,
            column: 98
          },
          end: {
            line: 15,
            column: 111
          }
        }],
        line: 15
      },
      "4": {
        loc: {
          start: {
            line: 16,
            column: 8
          },
          end: {
            line: 72,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 16,
            column: 8
          },
          end: {
            line: 72,
            column: 9
          }
        }, {
          start: {
            line: 16,
            column: 8
          },
          end: {
            line: 72,
            column: 9
          }
        }],
        line: 16
      },
      "5": {
        loc: {
          start: {
            line: 16,
            column: 12
          },
          end: {
            line: 16,
            column: 168
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 16,
            column: 13
          },
          end: {
            line: 16,
            column: 143
          }
        }, {
          start: {
            line: 16,
            column: 148
          },
          end: {
            line: 16,
            column: 168
          }
        }],
        line: 16
      },
      "6": {
        loc: {
          start: {
            line: 16,
            column: 13
          },
          end: {
            line: 16,
            column: 143
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 16,
            column: 126
          },
          end: {
            line: 16,
            column: 132
          }
        }, {
          start: {
            line: 16,
            column: 135
          },
          end: {
            line: 16,
            column: 143
          }
        }],
        line: 16
      },
      "7": {
        loc: {
          start: {
            line: 16,
            column: 13
          },
          end: {
            line: 16,
            column: 123
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 16,
            column: 13
          },
          end: {
            line: 16,
            column: 106
          }
        }, {
          start: {
            line: 16,
            column: 110
          },
          end: {
            line: 16,
            column: 123
          }
        }],
        line: 16
      },
      "8": {
        loc: {
          start: {
            line: 16,
            column: 19
          },
          end: {
            line: 16,
            column: 96
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 16,
            column: 70
          },
          end: {
            line: 16,
            column: 76
          }
        }, {
          start: {
            line: 16,
            column: 79
          },
          end: {
            line: 16,
            column: 96
          }
        }],
        line: 16
      },
      "9": {
        loc: {
          start: {
            line: 16,
            column: 19
          },
          end: {
            line: 16,
            column: 67
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 16,
            column: 19
          },
          end: {
            line: 16,
            column: 40
          }
        }, {
          start: {
            line: 16,
            column: 44
          },
          end: {
            line: 16,
            column: 67
          }
        }],
        line: 16
      },
      "10": {
        loc: {
          start: {
            line: 35,
            column: 16
          },
          end: {
            line: 45,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 35,
            column: 16
          },
          end: {
            line: 45,
            column: 17
          }
        }, {
          start: {
            line: 35,
            column: 16
          },
          end: {
            line: 45,
            column: 17
          }
        }],
        line: 35
      },
      "11": {
        loc: {
          start: {
            line: 47,
            column: 20
          },
          end: {
            line: 57,
            column: 21
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 47,
            column: 20
          },
          end: {
            line: 57,
            column: 21
          }
        }, {
          start: {
            line: 47,
            column: 20
          },
          end: {
            line: 57,
            column: 21
          }
        }],
        line: 47
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      file: "dataExport.js",
      sourceRoot: "",
      sources: ["../../routes/dataExport.ts"],
      names: [],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "ea22bf20e0da865f75fe2d6bfcafa919ab9a5860"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }

  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1c3i5590w3 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}

cov_1c3i5590w3();
cov_1c3i5590w3().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
const memory_1 = (cov_1c3i5590w3().s[1]++, require("../models/memory"));
const challengeUtils = (cov_1c3i5590w3().s[2]++, require("../lib/challengeUtils"));
const security = (cov_1c3i5590w3().s[3]++, require('../lib/insecurity'));
const db = (cov_1c3i5590w3().s[4]++, require('../data/mongodb'));
const challenges = (cov_1c3i5590w3().s[5]++, require('../data/datacache').challenges);
cov_1c3i5590w3().s[6]++;

module.exports = function dataExport() {
  cov_1c3i5590w3().f[0]++;
  cov_1c3i5590w3().s[7]++;
  return async (req, res, next) => {
    cov_1c3i5590w3().f[1]++;

    var _a, _b, _c;

    const loggedInUser = (cov_1c3i5590w3().s[8]++, security.authenticatedUsers.get((cov_1c3i5590w3().b[1][0]++, (_b = (cov_1c3i5590w3().b[3][0]++, (_a = req.headers) === null) || (cov_1c3i5590w3().b[3][1]++, _a === void 0) ? (cov_1c3i5590w3().b[2][0]++, void 0) : (cov_1c3i5590w3().b[2][1]++, _a.authorization)) === null) || (cov_1c3i5590w3().b[1][1]++, _b === void 0) ? (cov_1c3i5590w3().b[0][0]++, void 0) : (cov_1c3i5590w3().b[0][1]++, _b.replace('Bearer ', ''))));
    cov_1c3i5590w3().s[9]++;

    if ((cov_1c3i5590w3().b[5][0]++, (cov_1c3i5590w3().b[7][0]++, (_c = (cov_1c3i5590w3().b[9][0]++, loggedInUser === null) || (cov_1c3i5590w3().b[9][1]++, loggedInUser === void 0) ? (cov_1c3i5590w3().b[8][0]++, void 0) : (cov_1c3i5590w3().b[8][1]++, loggedInUser.data)) === null) || (cov_1c3i5590w3().b[7][1]++, _c === void 0) ? (cov_1c3i5590w3().b[6][0]++, void 0) : (cov_1c3i5590w3().b[6][1]++, _c.email)) && (cov_1c3i5590w3().b[5][1]++, loggedInUser.data.id)) {
      cov_1c3i5590w3().b[4][0]++;
      const username = (cov_1c3i5590w3().s[10]++, loggedInUser.data.username);
      const email = (cov_1c3i5590w3().s[11]++, loggedInUser.data.email);
      const updatedEmail = (cov_1c3i5590w3().s[12]++, email.replace(/[aeiou]/gi, '*'));
      const userData = (cov_1c3i5590w3().s[13]++, {
        username,
        email,
        orders: [],
        reviews: [],
        memories: []
      });
      const memories = (cov_1c3i5590w3().s[14]++, await memory_1.MemoryModel.findAll({
        where: {
          UserId: req.body.UserId
        }
      }));
      cov_1c3i5590w3().s[15]++;
      memories.forEach(memory => {
        cov_1c3i5590w3().f[2]++;
        cov_1c3i5590w3().s[16]++;
        userData.memories.push({
          imageUrl: req.protocol + '://' + req.get('host') + '/' + memory.imagePath,
          caption: memory.caption
        });
      });
      cov_1c3i5590w3().s[17]++;
      db.orders.find({
        email: updatedEmail
      }).then(orders => {
        cov_1c3i5590w3().f[3]++;
        cov_1c3i5590w3().s[18]++;

        if (orders.length > 0) {
          cov_1c3i5590w3().b[10][0]++;
          cov_1c3i5590w3().s[19]++;
          orders.forEach(order => {
            cov_1c3i5590w3().f[4]++;
            cov_1c3i5590w3().s[20]++;
            userData.orders.push({
              orderId: order.orderId,
              totalPrice: order.totalPrice,
              products: [...order.products],
              bonus: order.bonus,
              eta: order.eta
            });
          });
        } else {
          cov_1c3i5590w3().b[10][1]++;
        }

        cov_1c3i5590w3().s[21]++;
        db.reviews.find({
          author: email
        }).then(reviews => {
          cov_1c3i5590w3().f[5]++;
          cov_1c3i5590w3().s[22]++;

          if (reviews.length > 0) {
            cov_1c3i5590w3().b[11][0]++;
            cov_1c3i5590w3().s[23]++;
            reviews.forEach(review => {
              cov_1c3i5590w3().f[6]++;
              cov_1c3i5590w3().s[24]++;
              userData.reviews.push({
                message: review.message,
                author: review.author,
                productId: review.product,
                likesCount: review.likesCount,
                likedBy: review.likedBy
              });
            });
          } else {
            cov_1c3i5590w3().b[11][1]++;
          }

          const emailHash = (cov_1c3i5590w3().s[25]++, security.hash(email).slice(0, 4));
          cov_1c3i5590w3().s[26]++;

          for (const order of userData.orders) {
            cov_1c3i5590w3().s[27]++;
            challengeUtils.solveIf(challenges.dataExportChallenge, () => {
              cov_1c3i5590w3().f[7]++;
              cov_1c3i5590w3().s[28]++;
              return order.orderId.split('-')[0] !== emailHash;
            });
          }

          cov_1c3i5590w3().s[29]++;
          res.status(200).send({
            userData: JSON.stringify(userData, null, 2),
            confirmation: 'Your data export will open in a new Browser window.'
          });
        }, () => {
          cov_1c3i5590w3().f[8]++;
          cov_1c3i5590w3().s[30]++;
          next(new Error(`Error retrieving reviews for ${updatedEmail}`));
        });
      }, () => {
        cov_1c3i5590w3().f[9]++;
        cov_1c3i5590w3().s[31]++;
        next(new Error(`Error retrieving orders for ${updatedEmail}`));
      });
    } else {
      cov_1c3i5590w3().b[4][1]++;
      cov_1c3i5590w3().s[32]++;
      next(new Error('Blocked illegal activity by ' + req.connection.remoteAddress));
    }
  };
}; //# sourceMappingURL=dataExport.js.map
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQWlCUTs7Ozs7Ozs7Ozs7OztBQVhSO0FBR0E7QUFDQSxNQUFNQSxRQUFRLDZCQUFHQyxPQUFPLENBQUMsbUJBQUQsQ0FBVixDQUFkO0FBQ0EsTUFBTUMsRUFBRSw2QkFBR0QsT0FBTyxDQUFDLGlCQUFELENBQVYsQ0FBUjtBQUNBLE1BQU1FLFVBQVUsNkJBQUdGLE9BQU8sQ0FBQyxtQkFBRCxDQUFQLENBQTZCRSxVQUFoQyxDQUFoQjs7O0FBRUFDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixTQUFTQyxVQUFULEdBQW1CO0VBQUE7RUFBQTtFQUNsQyxPQUFPLE9BQU9DLEdBQVAsRUFBcUJDLEdBQXJCLEVBQW9DQyxJQUFwQyxLQUEwRDtJQUFBOzs7O0lBQy9ELE1BQU1DLFlBQVksNkJBQUdWLFFBQVEsQ0FBQ1csa0JBQVQsQ0FBNEJDLEdBQTVCLENBQWdDLHlFQUFHLENBQUNDLE9BQUosTUFBVyxJQUFYLGtDQUFXQyxhQUFYLGlDQUFXLE1BQVgsaUNBQVdBLEdBQUVDLGFBQWIsT0FBMEIsSUFBMUIsa0NBQTBCQyxhQUExQixpQ0FBMEIsTUFBMUIsaUNBQTBCQSxHQUFFQyxPQUFGLENBQVUsU0FBVixFQUFxQixFQUFyQixDQUExQixDQUFoQyxDQUFILENBQWxCO0lBRCtEOztJQUUvRCxJQUFJLHlHQUFZLFNBQVosOENBQVksV0FBWixpQ0FBWSxNQUFaLDZDQUFZLENBQUVDLElBQWQsT0FBa0IsSUFBbEIsa0NBQWtCQyxhQUFsQixpQ0FBa0IsTUFBbEIsaUNBQWtCQSxHQUFFQyxLQUFwQixtQ0FBNkJWLFlBQVksQ0FBQ1EsSUFBYixDQUFrQkcsRUFBL0MsQ0FBSixFQUF1RDtNQUFBO01BQ3JELE1BQU1DLFFBQVEsOEJBQUdaLFlBQVksQ0FBQ1EsSUFBYixDQUFrQkksUUFBckIsQ0FBZDtNQUNBLE1BQU1GLEtBQUssOEJBQUdWLFlBQVksQ0FBQ1EsSUFBYixDQUFrQkUsS0FBckIsQ0FBWDtNQUNBLE1BQU1HLFlBQVksOEJBQUdILEtBQUssQ0FBQ0gsT0FBTixDQUFjLFdBQWQsRUFBMkIsR0FBM0IsQ0FBSCxDQUFsQjtNQUNBLE1BQU1PLFFBQVEsOEJBdUJkO1FBQ0VGLFFBREY7UUFFRUYsS0FGRjtRQUdFSyxNQUFNLEVBQUUsRUFIVjtRQUlFQyxPQUFPLEVBQUUsRUFKWDtRQUtFQyxRQUFRLEVBQUU7TUFMWixDQXZCYyxDQUFkO01BK0JBLE1BQU1BLFFBQVEsOEJBQUcsTUFBTUMscUJBQVlDLE9BQVosQ0FBb0I7UUFBRUMsS0FBSyxFQUFFO1VBQUVDLE1BQU0sRUFBRXhCLEdBQUcsQ0FBQ3lCLElBQUosQ0FBU0Q7UUFBbkI7TUFBVCxDQUFwQixDQUFULENBQWQ7TUFuQ3FEO01Bb0NyREosUUFBUSxDQUFDTSxPQUFULENBQWtCQyxNQUFELElBQXdCO1FBQUE7UUFBQTtRQUN2Q1YsUUFBUSxDQUFDRyxRQUFULENBQWtCUSxJQUFsQixDQUF1QjtVQUNyQkMsUUFBUSxFQUFFN0IsR0FBRyxDQUFDOEIsUUFBSixHQUFlLEtBQWYsR0FBdUI5QixHQUFHLENBQUNLLEdBQUosQ0FBUSxNQUFSLENBQXZCLEdBQXlDLEdBQXpDLEdBQStDc0IsTUFBTSxDQUFDSSxTQUQzQztVQUVyQkMsT0FBTyxFQUFFTCxNQUFNLENBQUNLO1FBRkssQ0FBdkI7TUFJRCxDQUxEO01BcENxRDtNQTJDckRyQyxFQUFFLENBQUN1QixNQUFILENBQVVlLElBQVYsQ0FBZTtRQUFFcEIsS0FBSyxFQUFFRztNQUFULENBQWYsRUFBd0NrQixJQUF4QyxDQUE4Q2hCLE1BQUQsSUFNdkM7UUFBQTtRQUFBOztRQUNKLElBQUlBLE1BQU0sQ0FBQ2lCLE1BQVAsR0FBZ0IsQ0FBcEIsRUFBdUI7VUFBQTtVQUFBO1VBQ3JCakIsTUFBTSxDQUFDUSxPQUFQLENBQWVVLEtBQUssSUFBRztZQUFBO1lBQUE7WUFDckJuQixRQUFRLENBQUNDLE1BQVQsQ0FBZ0JVLElBQWhCLENBQXFCO2NBQ25CUyxPQUFPLEVBQUVELEtBQUssQ0FBQ0MsT0FESTtjQUVuQkMsVUFBVSxFQUFFRixLQUFLLENBQUNFLFVBRkM7Y0FHbkJDLFFBQVEsRUFBRSxDQUFDLEdBQUdILEtBQUssQ0FBQ0csUUFBVixDQUhTO2NBSW5CQyxLQUFLLEVBQUVKLEtBQUssQ0FBQ0ksS0FKTTtjQUtuQkMsR0FBRyxFQUFFTCxLQUFLLENBQUNLO1lBTFEsQ0FBckI7VUFPRCxDQVJEO1FBU0QsQ0FWRDtVQUFBO1FBQUE7O1FBREk7UUFhSjlDLEVBQUUsQ0FBQ3dCLE9BQUgsQ0FBV2MsSUFBWCxDQUFnQjtVQUFFUyxNQUFNLEVBQUU3QjtRQUFWLENBQWhCLEVBQW1DcUIsSUFBbkMsQ0FBeUNmLE9BQUQsSUFNbEM7VUFBQTtVQUFBOztVQUNKLElBQUlBLE9BQU8sQ0FBQ2dCLE1BQVIsR0FBaUIsQ0FBckIsRUFBd0I7WUFBQTtZQUFBO1lBQ3RCaEIsT0FBTyxDQUFDTyxPQUFSLENBQWdCaUIsTUFBTSxJQUFHO2NBQUE7Y0FBQTtjQUN2QjFCLFFBQVEsQ0FBQ0UsT0FBVCxDQUFpQlMsSUFBakIsQ0FBc0I7Z0JBQ3BCZ0IsT0FBTyxFQUFFRCxNQUFNLENBQUNDLE9BREk7Z0JBRXBCRixNQUFNLEVBQUVDLE1BQU0sQ0FBQ0QsTUFGSztnQkFHcEJHLFNBQVMsRUFBRUYsTUFBTSxDQUFDRyxPQUhFO2dCQUlwQkMsVUFBVSxFQUFFSixNQUFNLENBQUNJLFVBSkM7Z0JBS3BCQyxPQUFPLEVBQUVMLE1BQU0sQ0FBQ0s7Y0FMSSxDQUF0QjtZQU9ELENBUkQ7VUFTRCxDQVZEO1lBQUE7VUFBQTs7VUFXQSxNQUFNQyxTQUFTLDhCQUFHeEQsUUFBUSxDQUFDeUQsSUFBVCxDQUFjckMsS0FBZCxFQUFxQnNDLEtBQXJCLENBQTJCLENBQTNCLEVBQThCLENBQTlCLENBQUgsQ0FBZjtVQVpJOztVQWFKLEtBQUssTUFBTWYsS0FBWCxJQUFvQm5CLFFBQVEsQ0FBQ0MsTUFBN0IsRUFBcUM7WUFBQTtZQUNuQ2tDLGNBQWMsQ0FBQ0MsT0FBZixDQUF1QnpELFVBQVUsQ0FBQzBELG1CQUFsQyxFQUF1RCxNQUFLO2NBQUE7Y0FBQTtjQUFHLE9BQU9sQixLQUFLLENBQUNDLE9BQU4sQ0FBY2tCLEtBQWQsQ0FBb0IsR0FBcEIsRUFBeUIsQ0FBekIsTUFBZ0NOLFNBQXZDO1lBQWtELENBQWpIO1VBQ0Q7O1VBZkc7VUFnQkpoRCxHQUFHLENBQUN1RCxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7WUFBRXhDLFFBQVEsRUFBRXlDLElBQUksQ0FBQ0MsU0FBTCxDQUFlMUMsUUFBZixFQUF5QixJQUF6QixFQUErQixDQUEvQixDQUFaO1lBQStDMkMsWUFBWSxFQUFFO1VBQTdELENBQXJCO1FBQ0QsQ0F2QkQsRUF3QkEsTUFBSztVQUFBO1VBQUE7VUFDSDFELElBQUksQ0FBQyxJQUFJMkQsS0FBSixDQUFVLGdDQUFnQzdDLFlBQVksRUFBdEQsQ0FBRCxDQUFKO1FBQ0QsQ0ExQkQ7TUEyQkQsQ0E5Q0QsRUErQ0EsTUFBSztRQUFBO1FBQUE7UUFDSGQsSUFBSSxDQUFDLElBQUkyRCxLQUFKLENBQVUsK0JBQStCN0MsWUFBWSxFQUFyRCxDQUFELENBQUo7TUFDRCxDQWpERDtJQWtERCxDQTdGRCxNQTZGTztNQUFBO01BQUE7TUFDTGQsSUFBSSxDQUFDLElBQUkyRCxLQUFKLENBQVUsaUNBQWlDN0QsR0FBRyxDQUFDOEQsVUFBSixDQUFlQyxhQUExRCxDQUFELENBQUo7SUFDRDtFQUNGLENBbEdEO0FBbUdELENBcEdELEMiLCJuYW1lcyI6WyJzZWN1cml0eSIsInJlcXVpcmUiLCJkYiIsImNoYWxsZW5nZXMiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGF0YUV4cG9ydCIsInJlcSIsInJlcyIsIm5leHQiLCJsb2dnZWRJblVzZXIiLCJhdXRoZW50aWNhdGVkVXNlcnMiLCJnZXQiLCJoZWFkZXJzIiwiX2EiLCJhdXRob3JpemF0aW9uIiwiX2IiLCJyZXBsYWNlIiwiZGF0YSIsIl9jIiwiZW1haWwiLCJpZCIsInVzZXJuYW1lIiwidXBkYXRlZEVtYWlsIiwidXNlckRhdGEiLCJvcmRlcnMiLCJyZXZpZXdzIiwibWVtb3JpZXMiLCJtZW1vcnlfMSIsImZpbmRBbGwiLCJ3aGVyZSIsIlVzZXJJZCIsImJvZHkiLCJmb3JFYWNoIiwibWVtb3J5IiwicHVzaCIsImltYWdlVXJsIiwicHJvdG9jb2wiLCJpbWFnZVBhdGgiLCJjYXB0aW9uIiwiZmluZCIsInRoZW4iLCJsZW5ndGgiLCJvcmRlciIsIm9yZGVySWQiLCJ0b3RhbFByaWNlIiwicHJvZHVjdHMiLCJib251cyIsImV0YSIsImF1dGhvciIsInJldmlldyIsIm1lc3NhZ2UiLCJwcm9kdWN0SWQiLCJwcm9kdWN0IiwibGlrZXNDb3VudCIsImxpa2VkQnkiLCJlbWFpbEhhc2giLCJoYXNoIiwic2xpY2UiLCJjaGFsbGVuZ2VVdGlscyIsInNvbHZlSWYiLCJkYXRhRXhwb3J0Q2hhbGxlbmdlIiwic3BsaXQiLCJzdGF0dXMiLCJzZW5kIiwiSlNPTiIsInN0cmluZ2lmeSIsImNvbmZpcm1hdGlvbiIsIkVycm9yIiwiY29ubmVjdGlvbiIsInJlbW90ZUFkZHJlc3MiXSwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vcm91dGVzL2RhdGFFeHBvcnQudHMiXSwic291cmNlc0NvbnRlbnQiOltudWxsXX0=