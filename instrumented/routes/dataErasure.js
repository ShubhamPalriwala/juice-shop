"use strict";

function cov_1tkq653uc2() {
  var path = "/home/shubham/Desktop/juice-shop/build/routes/dataErasure.js";
  var hash = "301231314a3e2a876040520a0061bcdf058b5ffe";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/shubham/Desktop/juice-shop/build/routes/dataErasure.js",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 22
        },
        end: {
          line: 4,
          column: 1
        }
      },
      "1": {
        start: {
          line: 3,
          column: 4
        },
        end: {
          line: 3,
          column: 62
        }
      },
      "2": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 5,
          column: 62
        }
      },
      "3": {
        start: {
          line: 10,
          column: 18
        },
        end: {
          line: 10,
          column: 53
        }
      },
      "4": {
        start: {
          line: 11,
          column: 15
        },
        end: {
          line: 11,
          column: 47
        }
      },
      "5": {
        start: {
          line: 12,
          column: 25
        },
        end: {
          line: 12,
          column: 60
        }
      },
      "6": {
        start: {
          line: 13,
          column: 15
        },
        end: {
          line: 13,
          column: 40
        }
      },
      "7": {
        start: {
          line: 14,
          column: 27
        },
        end: {
          line: 14,
          column: 64
        }
      },
      "8": {
        start: {
          line: 15,
          column: 26
        },
        end: {
          line: 15,
          column: 62
        }
      },
      "9": {
        start: {
          line: 16,
          column: 19
        },
        end: {
          line: 16,
          column: 47
        }
      },
      "10": {
        start: {
          line: 17,
          column: 19
        },
        end: {
          line: 17,
          column: 58
        }
      },
      "11": {
        start: {
          line: 18,
          column: 23
        },
        end: {
          line: 18,
          column: 55
        }
      },
      "12": {
        start: {
          line: 19,
          column: 15
        },
        end: {
          line: 19,
          column: 41
        }
      },
      "13": {
        start: {
          line: 21,
          column: 0
        },
        end: {
          line: 47,
          column: 3
        }
      },
      "14": {
        start: {
          line: 22,
          column: 25
        },
        end: {
          line: 22,
          column: 77
        }
      },
      "15": {
        start: {
          line: 23,
          column: 4
        },
        end: {
          line: 26,
          column: 5
        }
      },
      "16": {
        start: {
          line: 24,
          column: 8
        },
        end: {
          line: 24,
          column: 87
        }
      },
      "17": {
        start: {
          line: 25,
          column: 8
        },
        end: {
          line: 25,
          column: 15
        }
      },
      "18": {
        start: {
          line: 27,
          column: 18
        },
        end: {
          line: 27,
          column: 41
        }
      },
      "19": {
        start: {
          line: 28,
          column: 4
        },
        end: {
          line: 46,
          column: 5
        }
      },
      "20": {
        start: {
          line: 29,
          column: 23
        },
        end: {
          line: 34,
          column: 10
        }
      },
      "21": {
        start: {
          line: 35,
          column: 8
        },
        end: {
          line: 37,
          column: 9
        }
      },
      "22": {
        start: {
          line: 36,
          column: 12
        },
        end: {
          line: 36,
          column: 48
        }
      },
      "23": {
        start: {
          line: 38,
          column: 25
        },
        end: {
          line: 38,
          column: 107
        }
      },
      "24": {
        start: {
          line: 39,
          column: 8
        },
        end: {
          line: 41,
          column: 9
        }
      },
      "25": {
        start: {
          line: 40,
          column: 12
        },
        end: {
          line: 40,
          column: 50
        }
      },
      "26": {
        start: {
          line: 42,
          column: 8
        },
        end: {
          line: 42,
          column: 97
        }
      },
      "27": {
        start: {
          line: 45,
          column: 8
        },
        end: {
          line: 45,
          column: 20
        }
      },
      "28": {
        start: {
          line: 49,
          column: 0
        },
        end: {
          line: 91,
          column: 3
        }
      },
      "29": {
        start: {
          line: 50,
          column: 25
        },
        end: {
          line: 50,
          column: 77
        }
      },
      "30": {
        start: {
          line: 51,
          column: 4
        },
        end: {
          line: 54,
          column: 5
        }
      },
      "31": {
        start: {
          line: 52,
          column: 8
        },
        end: {
          line: 52,
          column: 87
        }
      },
      "32": {
        start: {
          line: 53,
          column: 8
        },
        end: {
          line: 53,
          column: 15
        }
      },
      "33": {
        start: {
          line: 55,
          column: 4
        },
        end: {
          line: 90,
          column: 5
        }
      },
      "34": {
        start: {
          line: 56,
          column: 8
        },
        end: {
          line: 59,
          column: 11
        }
      },
      "35": {
        start: {
          line: 60,
          column: 8
        },
        end: {
          line: 60,
          column: 33
        }
      },
      "36": {
        start: {
          line: 61,
          column: 8
        },
        end: {
          line: 86,
          column: 9
        }
      },
      "37": {
        start: {
          line: 62,
          column: 29
        },
        end: {
          line: 62,
          column: 82
        }
      },
      "38": {
        start: {
          line: 63,
          column: 37
        },
        end: {
          line: 63,
          column: 132
        }
      },
      "39": {
        start: {
          line: 64,
          column: 12
        },
        end: {
          line: 80,
          column: 13
        }
      },
      "40": {
        start: {
          line: 65,
          column: 16
        },
        end: {
          line: 76,
          column: 19
        }
      },
      "41": {
        start: {
          line: 68,
          column: 20
        },
        end: {
          line: 75,
          column: 21
        }
      },
      "42": {
        start: {
          line: 69,
          column: 24
        },
        end: {
          line: 69,
          column: 55
        }
      },
      "43": {
        start: {
          line: 72,
          column: 48
        },
        end: {
          line: 72,
          column: 77
        }
      },
      "44": {
        start: {
          line: 73,
          column: 24
        },
        end: {
          line: 73,
          column: 50
        }
      },
      "45": {
        start: {
          line: 74,
          column: 24
        },
        end: {
          line: 74,
          column: 70
        }
      },
      "46": {
        start: {
          line: 79,
          column: 16
        },
        end: {
          line: 79,
          column: 59
        }
      },
      "47": {
        start: {
          line: 83,
          column: 12
        },
        end: {
          line: 85,
          column: 15
        }
      },
      "48": {
        start: {
          line: 89,
          column: 8
        },
        end: {
          line: 89,
          column: 20
        }
      },
      "49": {
        start: {
          line: 92,
          column: 0
        },
        end: {
          line: 92,
          column: 25
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 2,
            column: 56
          },
          end: {
            line: 2,
            column: 57
          }
        },
        loc: {
          start: {
            line: 2,
            column: 71
          },
          end: {
            line: 4,
            column: 1
          }
        },
        line: 2
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 21,
            column: 16
          },
          end: {
            line: 21,
            column: 17
          }
        },
        loc: {
          start: {
            line: 21,
            column: 42
          },
          end: {
            line: 47,
            column: 1
          }
        },
        line: 21
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 49,
            column: 17
          },
          end: {
            line: 49,
            column: 18
          }
        },
        loc: {
          start: {
            line: 49,
            column: 43
          },
          end: {
            line: 91,
            column: 1
          }
        },
        line: 49
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 67,
            column: 19
          },
          end: {
            line: 67,
            column: 20
          }
        },
        loc: {
          start: {
            line: 67,
            column: 36
          },
          end: {
            line: 76,
            column: 17
          }
        },
        line: 67
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 2,
            column: 22
          },
          end: {
            line: 4,
            column: 1
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 2,
            column: 23
          },
          end: {
            line: 2,
            column: 27
          }
        }, {
          start: {
            line: 2,
            column: 31
          },
          end: {
            line: 2,
            column: 51
          }
        }, {
          start: {
            line: 2,
            column: 56
          },
          end: {
            line: 4,
            column: 1
          }
        }],
        line: 2
      },
      "1": {
        loc: {
          start: {
            line: 3,
            column: 11
          },
          end: {
            line: 3,
            column: 61
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 3,
            column: 37
          },
          end: {
            line: 3,
            column: 40
          }
        }, {
          start: {
            line: 3,
            column: 43
          },
          end: {
            line: 3,
            column: 61
          }
        }],
        line: 3
      },
      "2": {
        loc: {
          start: {
            line: 3,
            column: 12
          },
          end: {
            line: 3,
            column: 33
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 3,
            column: 12
          },
          end: {
            line: 3,
            column: 15
          }
        }, {
          start: {
            line: 3,
            column: 19
          },
          end: {
            line: 3,
            column: 33
          }
        }],
        line: 3
      },
      "3": {
        loc: {
          start: {
            line: 23,
            column: 4
          },
          end: {
            line: 26,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 23,
            column: 4
          },
          end: {
            line: 26,
            column: 5
          }
        }, {
          start: {
            line: 23,
            column: 4
          },
          end: {
            line: 26,
            column: 5
          }
        }],
        line: 23
      },
      "4": {
        loc: {
          start: {
            line: 35,
            column: 8
          },
          end: {
            line: 37,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 35,
            column: 8
          },
          end: {
            line: 37,
            column: 9
          }
        }, {
          start: {
            line: 35,
            column: 8
          },
          end: {
            line: 37,
            column: 9
          }
        }],
        line: 35
      },
      "5": {
        loc: {
          start: {
            line: 39,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 39,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        }, {
          start: {
            line: 39,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        }],
        line: 39
      },
      "6": {
        loc: {
          start: {
            line: 51,
            column: 4
          },
          end: {
            line: 54,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 51,
            column: 4
          },
          end: {
            line: 54,
            column: 5
          }
        }, {
          start: {
            line: 51,
            column: 4
          },
          end: {
            line: 54,
            column: 5
          }
        }],
        line: 51
      },
      "7": {
        loc: {
          start: {
            line: 61,
            column: 8
          },
          end: {
            line: 86,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 61,
            column: 8
          },
          end: {
            line: 86,
            column: 9
          }
        }, {
          start: {
            line: 61,
            column: 8
          },
          end: {
            line: 86,
            column: 9
          }
        }],
        line: 61
      },
      "8": {
        loc: {
          start: {
            line: 63,
            column: 37
          },
          end: {
            line: 63,
            column: 132
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 63,
            column: 37
          },
          end: {
            line: 63,
            column: 61
          }
        }, {
          start: {
            line: 63,
            column: 65
          },
          end: {
            line: 63,
            column: 93
          }
        }, {
          start: {
            line: 63,
            column: 97
          },
          end: {
            line: 63,
            column: 132
          }
        }],
        line: 63
      },
      "9": {
        loc: {
          start: {
            line: 64,
            column: 12
          },
          end: {
            line: 80,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 64,
            column: 12
          },
          end: {
            line: 80,
            column: 13
          }
        }, {
          start: {
            line: 64,
            column: 12
          },
          end: {
            line: 80,
            column: 13
          }
        }],
        line: 64
      },
      "10": {
        loc: {
          start: {
            line: 68,
            column: 20
          },
          end: {
            line: 75,
            column: 21
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 68,
            column: 20
          },
          end: {
            line: 75,
            column: 21
          }
        }, {
          start: {
            line: 68,
            column: 20
          },
          end: {
            line: 75,
            column: 21
          }
        }],
        line: 68
      },
      "11": {
        loc: {
          start: {
            line: 68,
            column: 24
          },
          end: {
            line: 68,
            column: 38
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 68,
            column: 24
          },
          end: {
            line: 68,
            column: 29
          }
        }, {
          start: {
            line: 68,
            column: 33
          },
          end: {
            line: 68,
            column: 38
          }
        }],
        line: 68
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0
    },
    b: {
      "0": [0, 0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      file: "dataErasure.js",
      sourceRoot: "",
      sources: ["../../routes/dataErasure.ts"],
      names: [],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "301231314a3e2a876040520a0061bcdf058b5ffe"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }

  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1tkq653uc2 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}

cov_1tkq653uc2();

var __importDefault = (cov_1tkq653uc2().s[0]++, (cov_1tkq653uc2().b[0][0]++, this) && (cov_1tkq653uc2().b[0][1]++, this.__importDefault) || (cov_1tkq653uc2().b[0][2]++, function (mod) {
  cov_1tkq653uc2().f[0]++;
  cov_1tkq653uc2().s[1]++;
  return (cov_1tkq653uc2().b[2][0]++, mod) && (cov_1tkq653uc2().b[2][1]++, mod.__esModule) ? (cov_1tkq653uc2().b[1][0]++, mod) : (cov_1tkq653uc2().b[1][1]++, {
    "default": mod
  });
}));

cov_1tkq653uc2().s[2]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/*
 * Copyright (c) 2014-2022 Bjoern Kimminich & the OWASP Juice Shop contributors.
 * SPDX-License-Identifier: MIT
 */

const express_1 = (cov_1tkq653uc2().s[3]++, __importDefault(require("express")));
const path_1 = (cov_1tkq653uc2().s[4]++, __importDefault(require("path")));
const securityAnswer_1 = (cov_1tkq653uc2().s[5]++, require("../models/securityAnswer"));
const user_1 = (cov_1tkq653uc2().s[6]++, require("../models/user"));
const securityQuestion_1 = (cov_1tkq653uc2().s[7]++, require("../models/securityQuestion"));
const privacyRequests_1 = (cov_1tkq653uc2().s[8]++, require("../models/privacyRequests"));
const insecurity = (cov_1tkq653uc2().s[9]++, require('../lib/insecurity'));
const challenges = (cov_1tkq653uc2().s[10]++, require('../data/datacache').challenges);
const challengeUtils = (cov_1tkq653uc2().s[11]++, require('../lib/challengeUtils'));
const router = (cov_1tkq653uc2().s[12]++, express_1.default.Router()); // eslint-disable-next-line @typescript-eslint/no-misused-promises

cov_1tkq653uc2().s[13]++;
router.get('/', async (req, res, next) => {
  cov_1tkq653uc2().f[1]++;
  const loggedInUser = (cov_1tkq653uc2().s[14]++, insecurity.authenticatedUsers.get(req.cookies.token));
  cov_1tkq653uc2().s[15]++;

  if (!loggedInUser) {
    cov_1tkq653uc2().b[3][0]++;
    cov_1tkq653uc2().s[16]++;
    next(new Error('Blocked illegal activity by ' + req.connection.remoteAddress));
    cov_1tkq653uc2().s[17]++;
    return;
  } else {
    cov_1tkq653uc2().b[3][1]++;
  }

  const email = (cov_1tkq653uc2().s[18]++, loggedInUser.data.email);
  cov_1tkq653uc2().s[19]++;

  try {
    const answer = (cov_1tkq653uc2().s[20]++, await securityAnswer_1.SecurityAnswerModel.findOne({
      include: [{
        model: user_1.UserModel,
        where: {
          email
        }
      }]
    }));
    cov_1tkq653uc2().s[21]++;

    if (!answer) {
      cov_1tkq653uc2().b[4][0]++;
      cov_1tkq653uc2().s[22]++;
      throw new Error('No answer found!');
    } else {
      cov_1tkq653uc2().b[4][1]++;
    }

    const question = (cov_1tkq653uc2().s[23]++, await securityQuestion_1.SecurityQuestionModel.findByPk(answer.SecurityQuestionId));
    cov_1tkq653uc2().s[24]++;

    if (!question) {
      cov_1tkq653uc2().b[5][0]++;
      cov_1tkq653uc2().s[25]++;
      throw new Error('No question found!');
    } else {
      cov_1tkq653uc2().b[5][1]++;
    }

    cov_1tkq653uc2().s[26]++;
    res.render('dataErasureForm', {
      userEmail: email,
      securityQuestion: question.question
    });
  } catch (error) {
    cov_1tkq653uc2().s[27]++;
    next(error);
  }
}); // eslint-disable-next-line @typescript-eslint/no-misused-promises

cov_1tkq653uc2().s[28]++;
router.post('/', async (req, res, next) => {
  cov_1tkq653uc2().f[2]++;
  const loggedInUser = (cov_1tkq653uc2().s[29]++, insecurity.authenticatedUsers.get(req.cookies.token));
  cov_1tkq653uc2().s[30]++;

  if (!loggedInUser) {
    cov_1tkq653uc2().b[6][0]++;
    cov_1tkq653uc2().s[31]++;
    next(new Error('Blocked illegal activity by ' + req.connection.remoteAddress));
    cov_1tkq653uc2().s[32]++;
    return;
  } else {
    cov_1tkq653uc2().b[6][1]++;
  }

  cov_1tkq653uc2().s[33]++;

  try {
    cov_1tkq653uc2().s[34]++;
    await privacyRequests_1.PrivacyRequestModel.create({
      UserId: loggedInUser.data.id,
      deletionRequested: true
    });
    cov_1tkq653uc2().s[35]++;
    res.clearCookie('token');
    cov_1tkq653uc2().s[36]++;

    if (req.body.layout !== undefined) {
      cov_1tkq653uc2().b[7][0]++;
      const filePath = (cov_1tkq653uc2().s[37]++, path_1.default.resolve(req.body.layout).toLowerCase());
      const isForbiddenFile = (cov_1tkq653uc2().s[38]++, (cov_1tkq653uc2().b[8][0]++, filePath.includes('ftp')) || (cov_1tkq653uc2().b[8][1]++, filePath.includes('ctf.key')) || (cov_1tkq653uc2().b[8][2]++, filePath.includes('encryptionkeys')));
      cov_1tkq653uc2().s[39]++;

      if (!isForbiddenFile) {
        cov_1tkq653uc2().b[9][0]++;
        cov_1tkq653uc2().s[40]++;
        res.render('dataErasureResult', { ...req.body
        }, (error, html) => {
          cov_1tkq653uc2().f[3]++;
          cov_1tkq653uc2().s[41]++;

          if ((cov_1tkq653uc2().b[11][0]++, !html) || (cov_1tkq653uc2().b[11][1]++, error)) {
            cov_1tkq653uc2().b[10][0]++;
            cov_1tkq653uc2().s[42]++;
            next(new Error(error.message));
          } else {
            cov_1tkq653uc2().b[10][1]++;
            const sendlfrResponse = (cov_1tkq653uc2().s[43]++, html.slice(0, 100) + '......');
            cov_1tkq653uc2().s[44]++;
            res.send(sendlfrResponse);
            cov_1tkq653uc2().s[45]++;
            challengeUtils.solve(challenges.lfrChallenge);
          }
        });
      } else {
        cov_1tkq653uc2().b[9][1]++;
        cov_1tkq653uc2().s[46]++;
        next(new Error('File access not allowed'));
      }
    } else {
      cov_1tkq653uc2().b[7][1]++;
      cov_1tkq653uc2().s[47]++;
      res.render('dataErasureResult', { ...req.body
      });
    }
  } catch (error) {
    cov_1tkq653uc2().s[48]++;
    next(error);
  }
});
cov_1tkq653uc2().s[49]++;
exports.default = router; //# sourceMappingURL=dataErasure.js.map
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QUNELENBRkQsTUFFTztZQUFBO1lBQ0wsTUFBTUMsZUFBZSw4QkFBV0YsSUFBSSxDQUFDRyxLQUFMLENBQVcsQ0FBWCxFQUFjLEdBQWQsSUFBcUIsUUFBaEMsQ0FBckI7WUFESztZQUVMN0MsR0FBRyxDQUFDOEMsSUFBSixDQUFTRixlQUFUO1lBRks7WUFHTGxELGNBQWMsQ0FBQ3FELEtBQWYsQ0FBcUJ0RCxVQUFVLENBQUN1RCxZQUFoQztVQUNEO1FBQ0YsQ0FWRDtNQVdELENBWkQsTUFZTztRQUFBO1FBQUE7UUFDTC9DLElBQUksQ0FBQyxJQUFJSyxLQUFKLENBQVUseUJBQVYsQ0FBRCxDQUFKO01BQ0Q7SUFDRixDQWxCRCxNQWtCTztNQUFBO01BQUE7TUFDTE4sR0FBRyxDQUFDc0IsTUFBSixDQUFXLG1CQUFYLEVBQWdDLEVBQzlCLEdBQUd2QixHQUFHLENBQUNrQztNQUR1QixDQUFoQztJQUdEO0VBQ0YsQ0E5QkQsQ0E4QkUsT0FBT1IsS0FBUCxFQUFjO0lBQUE7SUFDZHhCLElBQUksQ0FBQ3dCLEtBQUQsQ0FBSjtFQUNEO0FBQ0YsQ0F4Q0Q7O0FBMENBd0Isa0JBQWV0RCxNQUFmLEMiLCJuYW1lcyI6WyJpbnNlY3VyaXR5IiwicmVxdWlyZSIsImNoYWxsZW5nZXMiLCJjaGFsbGVuZ2VVdGlscyIsInJvdXRlciIsImV4cHJlc3NfMSIsIlJvdXRlciIsImdldCIsInJlcSIsInJlcyIsIm5leHQiLCJsb2dnZWRJblVzZXIiLCJhdXRoZW50aWNhdGVkVXNlcnMiLCJjb29raWVzIiwidG9rZW4iLCJFcnJvciIsImNvbm5lY3Rpb24iLCJyZW1vdGVBZGRyZXNzIiwiZW1haWwiLCJkYXRhIiwiYW5zd2VyIiwic2VjdXJpdHlBbnN3ZXJfMSIsImZpbmRPbmUiLCJpbmNsdWRlIiwibW9kZWwiLCJ1c2VyXzEiLCJ3aGVyZSIsInF1ZXN0aW9uIiwic2VjdXJpdHlRdWVzdGlvbl8xIiwiZmluZEJ5UGsiLCJTZWN1cml0eVF1ZXN0aW9uSWQiLCJyZW5kZXIiLCJ1c2VyRW1haWwiLCJzZWN1cml0eVF1ZXN0aW9uIiwiZXJyb3IiLCJwb3N0IiwicHJpdmFjeVJlcXVlc3RzXzEiLCJjcmVhdGUiLCJVc2VySWQiLCJpZCIsImRlbGV0aW9uUmVxdWVzdGVkIiwiY2xlYXJDb29raWUiLCJib2R5IiwibGF5b3V0IiwidW5kZWZpbmVkIiwiZmlsZVBhdGgiLCJwYXRoXzEiLCJyZXNvbHZlIiwidG9Mb3dlckNhc2UiLCJpc0ZvcmJpZGRlbkZpbGUiLCJpbmNsdWRlcyIsImh0bWwiLCJtZXNzYWdlIiwic2VuZGxmclJlc3BvbnNlIiwic2xpY2UiLCJzZW5kIiwic29sdmUiLCJsZnJDaGFsbGVuZ2UiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3JvdXRlcy9kYXRhRXJhc3VyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6W251bGxdfQ==